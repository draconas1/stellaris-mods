# condan_comms_events.txt  Contingency Processing Core 1A6F
# Stellaris 2024 ModJam
# Contributors: Draconas

namespace = condan_comms

# Contact Hub
country_event = {
    id = condan_comms.001
    title = "TRANSMISSION"
    desc = {
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        text = condan_comms.001.desc.regular
    }
    #desc = {
    #    trigger = {
    #        has_authority = auth_machine_intelligence
    #    }
    #    text = crisis.2023.desc.b
    #}

    diplomatic = yes
    picture_event_data = { portrait = ai_crisis_1}

    is_triggered_only = yes

    option = {
        name = condan_comms.001.prevent
        is_dialog_only = yes
        response_text = condan_comms.001.prevent.response
    }

    option = {
        name = condan_comms.001.more
        is_dialog_only = yes
        response_text = condan_comms.001.more.response
    }

    option = {
        name = condan_comms.001.whathapped
        is_dialog_only = yes
        response_text = condan_comms.001.whathapped.response
    }

    option = {
        name = condan_comms.001.assistance
        is_dialog_only = yes
        response_text = condan_comms.001.assistance.response
    }

    option = {
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        name = condan_comms.001.helpyou
        is_dialog_only = yes
        response_text = condan_comms.001.helpyou.response.fleshy
    }

    option = {
        trigger = { has_authority = auth_machine_intelligence }
        name = condan_comms.001.helpyou
        is_dialog_only = yes
        response_text = condan_comms.001.helpyou.response.machine
    }

    option = {
        name = condan_comms.001.ok
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        response_text = condan_comms.001.ok.response.fleshy

        if = {
            limit = {
                NOR = {
                    has_tech_option = tech_mine_living_metal
                    has_technology = tech_mine_living_metal
                }
            }
            add_research_option = tech_mine_living_metal
        }

        event_target:condan_planet = {
            add_deposit = d_condan_metal_2
            add_modifier = { modifier = "condan_leader_trapped" days = -1 }
        }

        hidden_effect = {
            root = {
                save_global_event_target_as = condan_owner
            }
            create_country = {
                name = NAME_CONDAN
                type = condan
                name_list = "AI"
                flag = {
                    icon= {
                        category = "special"
                        file = "ai_01.dds"
                    }
                    background= {
                        category = "backgrounds"
                        file = "circle.dds"
                    }
                    colors={
                        "black"
                        "red"
                        "null"
                        "null"
                    }
                }
                effect = {
                    establish_communications_no_message = root
                    save_global_event_target_as = condan_country
                    set_variable = { which = condan_power value = 1 }
                }
            }
        }
    }

    option = {
        name = condan_comms.001.no
        response_text = condan_comms.001.no.response
    }
}



# Pre-repair comms
country_event = {
    id = condan_comms.010
    title = "NAME_CONDAN"
    desc = {
        #trigger = {
        #    NOT = { has_authority = auth_machine_intelligence }
        #}
        text = condan_comms.010.desc.regular
    }
    #desc = {
    #    trigger = {
    #        has_authority = auth_machine_intelligence
    #    }
    #    text = crisis.2023.desc.b
    #}

    diplomatic = yes
    is_triggered_only = yes

    picture_event_data = { portrait = ai_crisis_1}

    trigger = {
        FROM = {
            is_country_type = condan
            NOT = { has_country_flag = condan_repaired}
        }
        NOT = { has_country_flag = condan_diplomacy_engaged }
    }

    immediate = {
        set_country_flag = condan_diplomacy_engaged
    }

    after = {
        hidden_effect = {
            remove_country_flag = condan_diplomacy_engaged
        }
    }

    option = {
        name = condan_comms.010.assistance
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        is_dialog_only = yes
        response_text = condan_comms.010.assistance.response.fleshy
    }
    option = {
        name = condan_comms.010.assistance
        trigger = { has_authority = auth_machine_intelligence }
        is_dialog_only = yes
        response_text = condan_comms.010.assistance.response.machine
    }

    option = {
        name = condan_comms.010.how
        is_dialog_only = yes
        response_text = condan_comms.010.how.response
    }


    option = {
        name = condan_comms.010.bye
    }
}

# Hiring Comms
country_event = {
    id = condan_comms.020
    title = condan_comms.020.title
    desc = condan_comms.020.desc
    show_sound = ai_crisis_room_amb
    location = event_target:condan_planet
    is_triggered_only = yes

    event_window_type = leader_recruit
    picture_event_data = {
        portrait = event_target:condan_leader_temp
    }
    picture = GFX_leader_recruitment_bg_renowned

    immediate = {
        event_target:condan_country = {
            set_country_flag = condan_repaired
            create_species = {
                name = "NAME_CONDAN"
                class = "ROBOT"
                namelist = "AI"
                portrait = "hum_robot_red"
                immortal = yes
                traits = {
                    trait = "trait_mechanical"
                }
                effect = { save_global_event_target_as = condan_bot }
            }

            # The clone leader effect adds a skill pick
            # that i can't get rid of.
            # so i need to create a leader to display to the player
            # then kill them and create a new one.
            create_condan_leader_official = yes
            last_created_leader = {
                save_event_target_as = condan_leader_temp
                add_skill_without_trait_selection = 10
            }
        }
    }


    option = {
        # Special tag to make mark this is the hire option
        name = HIRE
        tag = hire_leader

        hidden_effect = {
            create_condan_leader_official = yes
            last_created_leader = {
                save_global_event_target_as = condan_leader
                add_skill_without_trait_selection = 10
                set_owner = root
            }
            set_global_flag = condan_recruited
            set_country_flag = condan_owner
            event_target:condan_planet = {
                assign_leader = event_target:condan_leader
            }
        }

        create_message = {
            type = MESSAGE_RECRUITED_LEADER
            localization =  MESSAGE_RECRUITED_LEADER_DESC
            days = @toast_message_days
            target = event_target:condan_leader
            variable = {
                type = name
                localization = LEADER
                scope = event_target:condan_leader
            }
            variable = {
                key = "border"
                value = "GFX_border_legendary"
            }
        }
    }

    option = {
        name = DISMISS
        # Special tag to mark this as the dismiss option
        tag = dismiss_leader
    }

    option = {
        name = condan_comms.020.why
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        is_dialog_only = yes
        response_text = condan_comms.020.why.response.fleshy
    }

    option = {
        name = condan_comms.020.prevent
        is_dialog_only = yes
        response_text = condan_comms.020.prevent.response
    }

    option = {
        name = condan_comms.020.trust
        is_dialog_only = yes
        response_text = condan_comms.020.trust.response.fleshy
    }

    option = {
        name = condan_comms.020.planet
        is_dialog_only = yes
        response_text = condan_comms.020.planet.response
    }

    option = {
        name = condan_comms.020.synth
        trigger = { NOT = { has_authority = auth_machine_intelligence} }
        is_dialog_only = yes
        response_text = condan_comms.020.synth.response.fleshy
    }

    after = {
        hidden_effect = {
            event_target:condan_leader_temp = {
                kill_leader = { show_notification = no }
            }
        }
    }
}


# Main comms - regular empire
country_event = {
    id = condan_comms.030
    title = condan_comms.030.title
    desc = condan_comms.030.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    trigger = {
        FROM = {
            is_country_type = condan
            has_country_flag = condan_repaired
        }
        NOT = { has_country_flag = condan_diplomacy_engaged }
        NOT = { has_authority = auth_machine_intelligence }
    }

    picture_event_data = { portrait = ai_crisis_1}

    immediate = { set_country_flag = condan_diplomacy_engaged }

    after = { hidden_effect = { remove_country_flag = condan_diplomacy_engaged } }

    # Sythetic Evolution dialogs
    # No APs
    option = {
        name = condan_comms.030.synths

        trigger = {
            condan_has_no_ap = yes
            NOT = { has_country_flag = condan_ap_situation}
        }
        response_text = condan_comms.030.synths.response.nopath

        hidden_effect = { set_country_flag = condan_ap_situation}
        start_situation = {
            type = condan_generate_unity_situation
            target = ROOT
        }
    }

    option = {
        name = condan_comms.030.synths
        trigger = {
            condan_has_no_ap = yes
            has_country_flag = condan_ap_situation
        }

        is_dialog_only = yes
        response_text = condan_comms.030.synths.response.nopath.onlyonce
    }

    # WRONG AP!  Hope you like your machine uprising!
    option = {
        name = condan_comms.030.synths
        trigger = { condan_has_other_ascension_path = yes}
        is_dialog_only = yes
        response_text = condan_comms.030.synths.response.no
    }

    # Synth AP, Missing Tech
    option = {
        name = condan_comms.030.synths
        trigger = { condan_has_synth_ap_missing_tech = yes}
        response_text = condan_comms.010.synths.response.synthgivetech
        capital_scope = {
            enable_special_project = {
                name = "CONDAN_SYNTH_EVOLUTION_TECH_PROJECT"
                location = this
                owner = root
            }
        }
    }

    # Synth AP, Has Tech, No tradition
    option = {
        name = condan_comms.030.synths
        trigger = {
            condan_has_synth_ap_missing_tradition = yes
            NOT = { has_country_flag = condan_tradition_situation}
        }
        response_text = condan_comms.030.synths.response.needtradition
        hidden_effect = { set_country_flag = condan_tradition_situation}
        start_situation = {
            type = condan_generate_unity_situation
            target = ROOT
        }
    }

    option = {
        name = condan_comms.030.synths
        trigger = {
            condan_has_synth_ap_missing_tradition = yes
            has_country_flag = condan_tradition_situation
        }
        is_dialog_only = yes
        response_text = condan_comms.030.synths.response.needtradition.onlyonce
    }

    # Synth AP, Has Tech, has tradition.  Take the sodding project!
    option = {
        name = condan_comms.030.synths
        trigger = { condan_has_synth_ap_no_project = yes}
        is_dialog_only = yes
        response_text = condan_comms.030.synths.response.dotheproject
    }

    # End Synth evolution

    option = {
        name = condan_comms.030.prevent
        is_dialog_only = yes
        response_text = condan_comms.030.prevent.response
    }

    option = {
        name = condan_comms.030.armies
        trigger = { has_country_flag = condan_enable_army_project }
        response_text = condan_comms.030.armies.response
        allow = {
            any_owned_planet = { is_same_value = event_target:condan_planet }
            condan_recruit_army_project = yes
        }
        condan_recruit_army = yes
    }

    option = {
        name = condan_comms.030.fleets
        trigger = { has_country_flag = condan_enable_fleet_project }
        allow = { any_owned_planet = { is_same_value = event_target:condan_planet } }
        response_text = condan_comms.030.fleets.response
        hidden_effect = { remove_country_flag = condan_enable_fleet_project}
        start_situation = {
            type = condan_repair_shipyard_situation
            target = event_target:condan_planet
        }
    }

    option = {
        name = condan_comms.030.buildfleet
        trigger = { has_country_flag = condan_can_recruit_fleets }
        allow = {
            any_owned_planet = { is_same_value = event_target:condan_planet }
            NOT = { has_country_flag = condan_recruiting_fleet}
        }
        response_text = condan_comms.030.buildfleet.response
        condan_build_fleet = yes
    }

    option = {
        name = condan_comms.030.gov
        trigger = {
            event_target:condan_leader = { NOT = { has_trait = subclass_official_governor }}
        }
        response_text = condan_comms.030.gov.response
        hidden_effect = {
            condan_switch_to_official = yes
            event_target:condan_leader = { condan_set_governor_traits = yes }
        }
    }

    option = {
        name = condan_comms.030.fleet
        trigger = {
            event_target:condan_leader = { NOT = { has_trait = subclass_commander_admiral }}
        }
        response_text = condan_comms.030.fleet.response
        hidden_effect = {
            condan_switch_to_commander = yes
            event_target:condan_leader = { condan_set_admiral_traits = yes }
        }
    }

    option = {
        name = condan_comms.030.council
        trigger = {
            event_target:condan_leader = { NOT = { has_trait = subclass_official_economy_councilor }}
        }
        response_text = condan_comms.030.council.response
        hidden_effect = {
            condan_switch_to_official = yes
            event_target:condan_leader = { condan_set_offical_councilor_traits = yes }
        }
    }

    option = {
        name = condan_comms.030.strat
        trigger = {
            event_target:condan_leader = { NOT = { has_trait = subclass_commander_councilor }}
        }
        response_text = condan_comms.030.strat.response
        hidden_effect = {
            condan_switch_to_commander = yes
            event_target:condan_leader = { condan_set_commander_councilor_traits = yes }
        }
    }

    option = {
        name = condan_comms.030.TERMINATOR
        response_text = condan_comms.030.TERMINATOR.response
        country_event = { id = condan_events.030 }
    }

    option = {
        name = condan_comms.030.EXIT
    }
}

# Congratulations on becoming Synthetics
country_event = {
    id = condan_comms.040
    title = condan_comms.040.title
    desc = condan_comms.040.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes
    fire_only_once = yes

    trigger = {
        has_country_flag = synthetic_empire
        NOT = { has_authority = auth_machine_intelligence }
    }

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.030.EXIT
    }
}

# Congratulations on becoming terminators
country_event = {
    id = condan_comms.041
    title = condan_comms.041.title
    desc = condan_comms.041.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.030.EXIT
    }
}

# Spiritualists are unhappy
country_event = {
    id = condan_comms.050
    title = condan_comms.050.title
    desc = condan_comms.050.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    #trigger = {
    #    is_regular_empire = yes
    #    is_spiritualist = yes
    #}

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.060.fire
        response_text = condan_comms.060.fire.response
    }

    option = {
        name = condan_comms.060.ignore
        response_text = condan_comms.060.ignore.response
        event_target:condan_leader = {
            add_trait = condan_leader_trait_controversial_2
        }
        add_modifier = {
            modifier = condan_spiritualists_unhappy
            days = -1
        }
    }

    option = {
        name = condan_comms.060.crackdown
        response_text = condan_comms.060.crackdown.response
        event_target:condan_leader = {
            add_trait = condan_leader_trait_controversial
        }
        add_modifier = {
            modifier = condan_spiritualists_unhappy
            days = 1800
        }
        add_modifier = {
            modifier = condan_authoritarian_happy
            days = 1800
        }
        every_owned_pop = {
            limit = {
                is_spiritualist = yes
                pop_has_happiness = yes
            }
            add_modifier = {
                modifier = condan_pop_unhappy
                days = 1800
            }
        }
    }

    option = {
        name = condan_comms.060.terminate
        response_text = condan_comms.060.terminate.response
        add_modifier = {
            modifier = condan_spiritualists_unhappy
            days = 3600
        }
        add_modifier = {
            modifier = condan_authoritarian_happy
            days = 3600
        }
        while = {
            count = 5
            random_owned_pop = {
                limit = {
                    is_spiritualist = yes
                    pop_has_happiness = yes
                }
                kill_pop = yes
            }
        }
        every_owned_pop = {
            limit = {
                is_spiritualist = yes
                pop_has_happiness = yes
            }
            add_modifier = {
                modifier = condan_pop_unhappy
                days = -1800
            }
        }
        # shift ethics would itneract badly if we have xenophiles.
        # sp need to do it manually
        if = {
            # if we are already fantastic authoritarian, then no change!
            limit = { NOT = { has_ethic = ethic_fanatic_authoritarian} }

            if = {
                # if we are regular auths then we are going fanatic.
                limit = { has_ethic = ethic_authoritarian}
                if = {
                    # We must be some flavour of spiritualist to get here, so either we are
                    # Fanatic spiritual / auth or we must be spiritual / auth / other
                    limit = { has_ethic = ethic_fanatic_spiritualist}
                    country_remove_ethic = ethic_fanatic_spiritualist
                    country_add_ethic = ethic_spiritualist
                    country_add_ethic = ethic_fanatic_authoritarian
                }
                else = {
                    country_remove_ethic = ethic_spiritualist
                    country_add_ethic = ethic_fanatic_authoritarian
                }
            }
            else = {
                # not auth at all, going to gain basic.
                if = {
                    # We must be some flavour of spiritualist to get here, so either we are
                    # Fanatic spiritual / other or we must be spiritual / other / other or spiritual / fanatic other
                    limit = { has_ethic = ethic_fanatic_spiritualist}
                    country_remove_ethic = ethic_fanatic_spiritualist
                    country_add_ethic = ethic_spiritualist
                    country_add_ethic = ethic_authoritarian
                }
                else = {
                    country_remove_ethic = ethic_spiritualist
                    country_add_ethic = ethic_authoritarian
                }
            }
        }
    }
}



# Xenophiles are unhappy
country_event = {
    id = condan_comms.060
    title = condan_comms.060.title
    desc = condan_comms.060.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    trigger = {
        is_regular_empire = yes
        is_xenophile = yes
    }

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.030.EXIT
    }
}


# recruit contingency armies
country_event = {
    id = condan_comms.070
    title = condan_comms.070.title
    desc = condan_comms.070.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.070.doit
        response_text = condan_comms.070.doit.response
        allow = { condan_recruit_army_project = yes }
        condan_recruit_army = yes
    }

    option = {
        name = condan_comms.070.later
        response_text = condan_comms.070.later.response
        hidden_effect = {
            set_country_flag = condan_enable_army_project
        }
    }
}

# recruit contingency fleets
country_event = {
    id = condan_comms.080
    title = condan_comms.080.title
    desc = condan_comms.080.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = { portrait = ai_crisis_1}

    option = {
        name = condan_comms.080.doit
        response_text = condan_comms.080.doit.response
        start_situation = {
            type = condan_repair_shipyard_situation
            target = event_target:condan_planet
        }
    }

    option = {
        name = condan_comms.080.later
        response_text = condan_comms.080.later.response
        hidden_effect = {
            set_country_flag = condan_enable_fleet_project
        }
    }
}

country_event = {
    id = condan_comms.081
    title = condan_comms.081.title
    desc = condan_comms.081.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes

    picture_event_data = { portrait = ai_crisis_1}

    immediate = {
        set_country_flag = condan_can_recruit_fleets
    }

    option = {
        name = condan_comms.081.doit
        response_text = condan_comms.081.doit.response
        condan_build_fleet = yes
    }

    option = { name = condan_comms.030.EXIT}
}

country_event = {
    id = condan_comms.082
    title = condan_comms.082.title
    desc = condan_comms.082.desc
    show_sound = ai_crisis_room_amb
    is_triggered_only = yes
    diplomatic = yes
    picture_event_data = { portrait = ai_crisis_1}

    immediate = {
        create_fleet = {
            effect = {
                set_owner = ROOT
                while = {
                    count = 10
                    create_ship = {
                        name = random
                        design = "NAME_Euthanizer"
                        graphical_culture = "ai_01"
                    }
                }
                while = {
                    count = 20
                    create_ship = {
                        name = random
                        design = "NAME_Sterilizer"
                        graphical_culture = "ai_01"
                    }
                }
                set_location = {
                    target = event_target:condan_planet
                    distance = 45
                    angle = random
                }
            }
        }
    }

    option = {
        name = condan_comms.082.doitagain
        response_text = condan_comms.082.doitagain.response
        condan_build_fleet = yes
    }

    option = { name = condan_comms.030.EXIT}
}