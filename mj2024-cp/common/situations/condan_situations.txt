# condan_situations.txt  Contingency Processing Core 1A6F
# Stellaris 2024 ModJam
# Contributors: Draconas

condan_generate_unity_situation = {
    category = positive
    picture = GFX_evt_news_room
    complete_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_positive
    fail_icon_frame = GFX_situation_outcome_frame_red
    fail_icon = GFX_situation_outcome_meh

    on_progress_complete = {
        destroy_situation = this
        custom_tooltip = condan_generate_unity_situation_finish
    }

    on_abort = {
        destroy_situation = this
    }

    abort_trigger = {
        target = { has_ascension_perk = ap_synthetic_evolution}
    }

    stages = {
        stage_1 = {
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_green
            end = 100
            custom_tooltip = condan_generate_unity_situation_effect
        }
    }

    approach = {#Encourage
        name = approach_encourage
        on_select = {
            custom_tooltip = condan_generate_unity_situation_approve
        }
        resources = { 						#Resource table as standard
            category = situations
            cost = { }
            upkeep = {
                influence = 0.5
                energy = 100
            }
            produces = {
                unity = 500
            }
        }
        icon = GFX_situation_approach_amenities
        icon_background = GFX_situation_approach_bg_green
        ai_weight = {
            base = 10
        }
        default = yes
    }
    approach = {#Discourage
        name = approach_discourage
        on_select = {
            custom_tooltip = condan_generate_unity_situation_discourage
        }
        icon = GFX_situation_approach_shrug
        icon_background = GFX_situation_approach_bg_yellow
        ai_weight = {
            base = 0
        }
    }

    monthly_progress = {
        base = 4
        modifier = {
            desc = string_current_approach
            current_situation_approach = approach_encourage
        }
        modifier = {
            desc = string_current_approach
            current_situation_approach = approach_discourage
        }
    }
}

condan_repair_shipyard_situation = {
    category = positive
    picture = GFX_evt_ai_planet
    complete_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_positive
    fail_icon_frame = GFX_situation_outcome_frame_red
    fail_icon = GFX_situation_outcome_meh

    on_progress_complete = {
        custom_tooltip = condan_repair_shipyard_situation_finish
        hidden_effect = {
            destroy_situation = this
            target.owner = {
                country_event = { id = condan_comms.081 }
            }
        }
    }

    on_abort = {
        destroy_situation = this
        if = {
            limit = { exists = target.owner }
            target.owner = { set_country_flag = condan_enable_fleet_project}
        }
    }

    abort_trigger = {
        OR = {
            NOT = { exists = target.owner }
            target.owner = { NOT = { is_same_value = root.owner } }
        }
    }

    triggered_target_modifier = {
        potential = { NOT = { current_situation_approach = approach_none } }
        modifier = {
            planet_jobs_alloys_produces_mult = -0.25
        }
    }

    stages = {
        stage_1 = {
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_green
            end = 100
            custom_tooltip = condan_repair_shipyard_situation_effect
        }
    }

    approach = {# Do it
        name = approach_doit
        on_select = {
            custom_tooltip = condan_repair_shipyard_situation_doit
        }
        resources = { 
            category = situations
            cost = { }
            upkeep = {
                alloys = 50
                energy = 100
                sr_living_metal = 5
                engineering_research = 100
            }
            produces = {
            }
        }
        icon = GFX_situation_approach_balance_sheet
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 10 }
        default = yes
    }
    approach = {# Do it faster
        name = approach_doitharder
        on_select = {
            custom_tooltip = condan_repair_shipyard_situation_doitharder
        }
        resources = { 
            category = situations
            cost = { }
            upkeep = {
                alloys = 250
                energy = 400
                sr_living_metal = 20
                engineering_research = 500
            }
            produces = {
            }
        }
        icon = GFX_situation_approach_energy_credits
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 0 }
    }



    approach = {# No Resource
        name = approach_none
        on_select = {
            custom_tooltip = condan_repair_shipyard_situation_none
        }
        icon = GFX_situation_approach_shrug
        icon_background = GFX_situation_approach_bg_red
        ai_weight = { base = 0 }
    }

    monthly_progress = {
        base = 0
        modifier = {
            add = 1
            desc = string_current_approach
            current_situation_approach = approach_doit
        }
         modifier = {
             add = 3
            desc = string_current_approach
            current_situation_approach = approach_doitharder
        }
        modifier = {
            desc = string_current_approach
            current_situation_approach = approach_none
        }
    }
}

condan_build_ships_situation = {
    category = positive
    picture = GFX_evt_ai_planet
    complete_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_positive
    fail_icon_frame = GFX_situation_outcome_frame_red
    fail_icon = GFX_situation_outcome_meh

    on_progress_complete = {
        custom_tooltip = condan_build_ships_situation_finish
        hidden_effect = {
            destroy_situation = this
            target.owner = {
                remove_country_flag = condan_recruiting_fleet
                country_event = { id = condan_comms.082 }
            }
        }
    }

    on_abort = {
        destroy_situation = this
        if = {
            limit = { exists = target.owner }
            target.owner = { remove_country_flag = condan_recruiting_fleet}
        }
    }

    abort_trigger = {
        OR = {
            NOT = { exists = target.owner }
            target.owner = { NOT = { is_same_value = root.owner } }
        }
    }

    stages = {
        stage_1 = {
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_green
            end = 100
            custom_tooltip = condan_build_ships_situation_effect
        }
    }

    approach = { # Do it
        name = approach_doit
        on_select = { custom_tooltip = condan_build_ships_situation_doit }
        resources = {
            category = situations
            upkeep = {
                alloys = 150
                sr_living_metal = 2
                volatile_motes = 1
                rare_crystals = 2
                exotic_gases = 2
            }
        }
        icon = GFX_situation_approach_balance_sheet
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 10 }
        default = yes
    }
    approach = {# Do it faster
        name = approach_doitharder
        on_select = { custom_tooltip = condan_build_ships_situation_doitharder }
        resources = {
            category = situations
            upkeep = {
                alloys = 450
                sr_living_metal = 5
                volatile_motes = 3
                rare_crystals = 5
                exotic_gases = 5
            }
        }
        icon = GFX_situation_approach_energy_credits
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 0 }
    }

    approach = {# No Resource
        name = approach_none
        on_select = { custom_tooltip = condan_build_ships_situation_no }
        icon = GFX_situation_approach_shrug
        icon_background = GFX_situation_approach_bg_red
        ai_weight = { base = 0 }
    }

    monthly_progress = {
        base = 0
        modifier = {
            add = 1.5 # takes 67 months or just over 5 years
            desc = string_current_approach
            current_situation_approach = approach_doit
        }
         modifier = {
            add = 3 # 34 months or just under 3 years
            desc = string_current_approach
            current_situation_approach = approach_doitharder
        }
        modifier = {
            desc = string_current_approach
            current_situation_approach = approach_none
        }
    }
}




condan_become_terminator_situation_regular = {
    category = positive
    picture = GFX_evt_machine_sapience
    complete_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_positive
    fail_icon_frame = GFX_situation_outcome_frame_red
    fail_icon = GFX_situation_outcome_meh

    on_progress_complete = {
        custom_tooltip = condan_become_terminator_situation_regular_finish
        hidden_effect = {
            destroy_situation = this
            target = {
                country_event = { id = condan_events.030 }
            }
        }
    }

    on_abort = {
        destroy_situation = this
    }

    abort_trigger = {
    }

    stages = {
        stage_1 = { # building core intelligence
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_green
            end = 100
            custom_tooltip = condan_become_terminator_situation_regular_stage_1
        }
        stage_2 = { # updating bodies and establishing network
            icon = GFX_situation_stage_2
            icon_background = GFX_situation_stage_frame_green
            end = 200
            custom_tooltip = condan_become_terminator_situation_regular_stage_2
            on_first_enter = { situation_event = { id = condan_events.142 } }
            triggered_modifier = {
                potential = { target = { dislikes_condan = yes } }
                modifier = {
                    biological_pop_happiness = -0.2
                    planet_stability_add = -10
                }
            }
        }
        stage_3 = { # enabling network and coming online
            icon = GFX_situation_stage_3
            icon_background = GFX_situation_stage_frame_green
            end = 300
            custom_tooltip = condan_become_terminator_situation_regular_stage_3
            on_first_enter = { situation_event = { id = condan_events.143 } }
            triggered_modifier = {
                potential = {
                    target = { dislikes_condan = yes }
                    has_situation_flag = increased_costs
                }
                modifier = {
                    biological_pop_happiness = -0.33
                    planet_stability_add = -30
                }
            }
        }
    }

    approach = { # Do it
        name = approach_doit
        on_select = { custom_tooltip = condan_become_terminator_situation_regular_doit }
        resources = {
            category = situations
            upkeep = { influence = 2 }
            upkeep = {
                influence = 1
                trigger = { has_situation_flag = increased_costs}
            }

            upkeep = {
                energy = 5
                sr_living_metal = 0.05
                physics_research = 10
                engineering_research = 10
                multiplier = target.trigger:num_owned_planets
                trigger = { current_stage = stage_1 }
            }

            upkeep = {
                energy = 2
                unity = 3
                sr_living_metal = 0.01
                physics_research = 2
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_2 }
            }

            upkeep = {
                unity = 3
                society_research = 3
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_2
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_3 }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_3
                    has_situation_flag = increased_costs
                }
            }
        }
        icon = GFX_situation_approach_balance_sheet
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 10 }
        default = yes
    }
    approach = {# Do it faster
        name = approach_doitharder
        on_select = { custom_tooltip = condan_become_terminator_situation_regular_doitharder }
        resources = {
            category = situations
            upkeep = { influence = 3 }
            upkeep = {
                influence = 2
                trigger = { has_situation_flag = increased_costs}
            }

            #TODO CLean this up in a balance pass
            # Tripled the costs by just repasting the cost blocks in.  It's quick and dirty for playtesting.

            upkeep = {
                energy = 5
                sr_living_metal = 0.05
                physics_research = 10
                engineering_research = 10
                multiplier = target.trigger:num_owned_planets
                trigger = { current_stage = stage_1 }
            }

            upkeep = {
                energy = 2
                unity = 3
                sr_living_metal = 0.01
                physics_research = 2
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_2 }
            }

            upkeep = {
                unity = 3
                society_research = 3
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_2
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_3 }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_3
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 5
                sr_living_metal = 0.05
                physics_research = 10
                engineering_research = 10
                multiplier = target.trigger:num_owned_planets
                trigger = { current_stage = stage_1 }
            }

            upkeep = {
                energy = 2
                unity = 3
                sr_living_metal = 0.01
                physics_research = 2
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_2 }
            }

            upkeep = {
                unity = 3
                society_research = 3
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_2
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_3 }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_3
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 5
                sr_living_metal = 0.05
                physics_research = 10
                engineering_research = 10
                multiplier = target.trigger:num_owned_planets
                trigger = { current_stage = stage_1 }
            }

            upkeep = {
                energy = 2
                unity = 3
                sr_living_metal = 0.01
                physics_research = 2
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_2 }
            }

            upkeep = {
                unity = 3
                society_research = 3
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_2
                    has_situation_flag = increased_costs
                }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = { current_stage = stage_3 }
            }

            upkeep = {
                energy = 3
                unity = 4
                society_research = 3
                engineering_research = 2
                multiplier = target.trigger:num_pops
                trigger = {
                    current_stage = stage_3
                    has_situation_flag = increased_costs
                }
            }
        }
        icon = GFX_situation_approach_energy_credits
        icon_background = GFX_situation_approach_bg_green
        ai_weight = { base = 0 }
    }

    approach = {# No Resource
        name = approach_none
        on_select = { custom_tooltip = condan_become_terminator_situation_regular_no }
        icon = GFX_situation_approach_shrug
        icon_background = GFX_situation_approach_bg_red
        ai_weight = { base = 0 }
    }

    monthly_progress = {
        base = 0
        modifier = {
            add = 5 # takes 60 months
            desc = string_current_approach
            current_situation_approach = approach_doit
        }
        modifier = {
            add = 10 # 34 months or just under 3 years
            desc = string_current_approach
            current_situation_approach = approach_doitharder
        }
        modifier = {
            desc = string_current_approach
            current_situation_approach = approach_none
        }
        modifier = {
            factor = 0.25
            desc = condan_become_terminator_situation_regular_deficit
            target = {
                OR = {
                    has_deficit = influence
                    has_deficit = energy
                    has_deficit = sr_living_metal
                    has_deficit = physics_research
                    has_deficit = engineering_research
                }
            }
            current_stage = stage_1
        }

        modifier = {
            factor = 0.25
            desc = condan_become_terminator_situation_regular_deficit
            target = {
                OR = {
                    has_deficit = influence
                    has_deficit = energy
                    has_deficit = unity
                    has_deficit = sr_living_metal
                    has_deficit = physics_research
                    has_deficit = society_research
                    has_deficit = engineering_research
                }
            }
            current_stage = stage_2
        }

        modifier = {
            factor = 0.25
            desc = condan_become_terminator_situation_regular_deficit
            target = {
                OR = {
                    has_deficit = influence
                    has_deficit = energy
                    has_deficit = unity
                    has_deficit = society_research
                    has_deficit = engineering_research
                }
            }
            current_stage = stage_3
        }
    }
}