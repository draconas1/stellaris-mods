namespace = leaderacademy


#opening event
country_event = { 
	id = leaderacademy.01
	title = leaderacademy.01.title
	desc = leaderacademy.01.desc
	picture = GFX_evt_ancient_databank
	is_triggered_only = yes

    trigger = {
        has_paragon_dlc = yes
    }

	immediate = {
        save_event_target_as = la_leader_owner

        if = {
            limit = { NOT = { exists = event_target:la_leader_species} }
            la_get_leader_species = yes
        }
	}
	
	option = {
		name = leaderacademy.close
		hidden_effect = { la_cancel = yes }
	}

    option = {
        name = leaderacademy.900.title
        hidden_effect = {
            country_event = { id = leaderacademy.900 }
        }
    }

	option = {
		name = leaderacademy.01.science
        hidden_effect = {
            la_create_leader_3 = { CLASS = scientist }
            event_target:la_in_progress_leader = { leader_event = { id = leaderacademy.999 }}
        }
	}

	option = {
		name = leaderacademy.01.official
        hidden_effect = {
            la_create_leader_3 = { CLASS = official }
            event_target:la_in_progress_leader = { leader_event = { id = leaderacademy.999 }}
        }
	}

	option = {
		name = leaderacademy.01.commander
        hidden_effect = {
            la_create_leader_3 = { CLASS = commander }
            event_target:la_in_progress_leader = { leader_event = { id = leaderacademy.999 }}
        }
	}

	option = {
		name = leaderacademy.01.detox
		allow = {
			custom_tooltip = {
				fail_text = leaderacademy.need_level_3
				capital_scope = { la_has_any_academy_building_3 = yes }
			}
			custom_tooltip = {
				fail_text = leaderacademy.rehab_ongoing
				NOT = { has_modifier = la_on_rehab }
			}
			custom_tooltip = {
				fail_text = leaderacademy.no_leader_with_bad_traits
				any_owned_leader = { la_is_valid_for_detox = yes }
			}
		}
		country_event = {
			id = leaderacademy.200
		}
	}

    option = {
        name = leaderacademy.01.enclave
        allow = {
            custom_tooltip = {
                fail_text = leaderacademy.need_level_3
                capital_scope = { la_has_any_academy_building_3 = yes }
            }
            la_has_any_education_pick = yes
        }
        country_event = { id = leaderacademy.500 }
    }

    option = {
        name = decision_la_recruit_paragons
        custom_tooltip = decision_la_recruit_paragons_desc

        trigger = {
            has_technology = tech_xeno_linguistics
            is_homicidal = no
        }

        allow = {
            capital_scope = {
                la_has_any_academy_building_4 = yes
            }
            any_owned_starbase = { has_starbase_building = recruitment_office }
            custom_tooltip = {
                fail_text = "requires_paragon_recruit_no_cooldown"
                NOT = { has_modifier = paragon_recruit_cooldown }
            }
            la_can_afford_paragon = yes
            la_has_any_education_pick = yes
        }
        country_event = {
            id = leaderacademy.300
        }
    }

    option = {
        name = leaderacademy.400.title

        trigger = {
            has_technology = tech_xeno_linguistics
            is_homicidal = no
        }

        allow = {
            capital_scope = {
                la_has_any_academy_building_5 = yes
            }
            any_owned_starbase = { has_starbase_building = recruitment_office }
            la_can_afford_legend = yes
            la_has_all_education_pick = yes
        }
        country_event = {
            id = leaderacademy.400
        }
    }
}



##############################################Remove negative traits

country_event = { 
	id = leaderacademy.200
	title = leaderacademy.200.title
	desc = leaderacademy.200.desc
	picture = GFX_evt_emergency_workers
	is_triggered_only = yes

	immediate = {
		random_owned_leader = {
			limit = { la_is_valid_for_detox = yes }
			save_event_target_as = la_detox_leader_choice_1
		}
        random_owned_leader = {
            limit = {
                la_is_valid_for_detox = yes
                NOR = { is_same_value = event_target:la_detox_leader_choice_1  }
            }
            save_event_target_as = la_detox_leader_choice_2
        }
        random_owned_leader = {
            limit = {
                la_is_valid_for_detox = yes
                NOR = {
                    is_same_value = event_target:la_detox_leader_choice_1
                    is_same_value = event_target:la_detox_leader_choice_2
                }
            }
            save_event_target_as = la_detox_leader_choice_3
        }
	}

	option = {
		name = leaderacademy.back
		hidden_effect = { country_event = { id = leaderacademy.01 } }
	}
	
	option = {
		name = leaderacademy.200.leader.1
        inline_script = { script = la/detox_effects CHOICE = 1 }
	}

    option = {
        name = leaderacademy.200.leader.2
        inline_script = { script = la/detox_effects CHOICE = 2 }
    }

    option = {
        name = leaderacademy.200.leader.3
        inline_script = { script = la/detox_effects CHOICE = 3 }
    }
}

country_event = { 
	id = leaderacademy.201
	title = leaderacademy.201.title
	desc = leaderacademy.201.desc
	picture = GFX_evt_emergency_workers
	is_triggered_only = yes

	immediate = {
		event_target:la_detox_leader = {
            remove_all_negative_traits = yes

			# ours - just to be sure
			remove_trait = la_commander_detox
			remove_trait = la_scientist_detox
			remove_trait = la_official_detox
			remove_trait = la_ruler_detox
		}
	}

	option = {
		name = leaderacademy.close
	}	
}


########################### Recruit paragons

country_event = {
    id = leaderacademy.300
    title = leaderacademy.300.title
    desc = leaderacademy.300.desc
    picture = GFX_evt_ancient_databank
    is_triggered_only = yes

    option = {
        name = leaderacademy.back
        hidden_effect = { country_event = { id = leaderacademy.01 } }
    }

    inline_script = { script = la/paragon_leader_option FLAG = xenophile_leader_1 ID = 40100 }
    inline_script = { script = la/paragon_leader_option FLAG = xenophile_leader_2 ID = 40200 }
    inline_script = { script = la/paragon_leader_option FLAG = militarist_leader_1 ID = 40300 }
    inline_script = { script = la/paragon_leader_option FLAG = militarist_leader_2 ID = 40400 }
    inline_script = { script = la/paragon_leader_option FLAG = xenophobe_leader_1 ID = 40500 }
    inline_script = { script = la/paragon_leader_option FLAG = xenophobe_leader_2 ID = 40600 }
    inline_script = { script = la/paragon_leader_option FLAG = egalitarian_leader_1 ID = 40700 }
    inline_script = { script = la/paragon_leader_option FLAG = egalitarian_leader_2 ID = 40800 }
    inline_script = { script = la/paragon_leader_option FLAG = materialist_leader_1 ID = 40900 }
    inline_script = { script = la/paragon_leader_option FLAG = materialist_leader_2 ID = 41000 }
    inline_script = { script = la/paragon_leader_option FLAG = pacifist_leader_1 ID = 41100 }
    inline_script = { script = la/paragon_leader_option FLAG = pacifist_leader_2 ID = 41200 }
    inline_script = { script = la/paragon_leader_option FLAG = authoritarian_leader_1 ID = 41300 }
    inline_script = { script = la/paragon_leader_option FLAG = authoritarian_leader_2 ID = 41400 }
    inline_script = { script = la/paragon_leader_option FLAG = spiritualist_leader_1 ID = 41500 }
    inline_script = { script = la/paragon_leader_option FLAG = spiritualist_leader_2 ID = 41600 }
}



#####################Recruit legends

country_event = {
    id = leaderacademy.400
    title = leaderacademy.400.title
    desc = leaderacademy.400.desc
    picture = GFX_evt_ancient_databank
    is_triggered_only = yes

    option = {
        name = leaderacademy.back
        hidden_effect = { country_event = { id = leaderacademy.01 } }
    }

    option = {
        name = NAME_Skrand_Sharpbeak
        allow = {
            la_can_afford_legend = yes
            is_ai = no
            custom_tooltip_fail = {
                text = leaderacademy.skrand.must.not.have.spawned
                NOR = {
                    has_global_flag = sharpbeak_recruit_phase
                    exists = event_target:admiral_sharpbeak
                }
            }
        }
        la_pay_for_legend = yes
        hidden_effect = {
            owner.capital_scope.solar_system = { save_event_target_as = gateway_system }
            owner.capital_scope.solar_system = { save_event_target_as = paragon_gateway_dude_homegate }
            owner.capital_scope.solar_system = { set_star_flag = sharpbeak_starsystem }
            set_global_flag = sharpbeak_recruit_phase
        }
        country_event = {
            id = paragon.3001
        }
    }

    option = {
        name = NAME_Astrocreator_Azaryn
        allow = {
            la_can_afford_legend = yes
            custom_tooltip_fail = {
                text = leaderacademy.azaryn.must.not.have.spawned
                NOT = { exists = event_target:azaryn_leader }
            }
            has_country_flag = first_contact_protocol_event_happened
            is_ai = no
            is_militarist = no
            is_gestalt = no
        }
        la_pay_for_legend = yes
        country_event = { id = paragon.202 }
    }

    option = {
        name = NAME_Exakeides

        allow = {
            la_can_afford_legend = yes
            custom_tooltip_fail = {
                text = leaderacademy.exakeides.must.not.have.spawned
                NOR = {
                    any_system = { has_star_flag = legendary_leader_spawn_system }
                }
            }
        }
        la_pay_for_legend = yes
        hidden_effect = {
            set_spawn_system_batch = begin
            capital_scope = {
                solar_system = {
                    spawn_system = {
                        min_distance = 10
                        max_distance = 30
                        max_jumps = 0
                        initializer = "la_legendary_leader_start_site"
                        hyperlane = no
                        is_discovered = yes
                        effect = {
                            save_event_target_as = ex_system
                        }
                    }

                    add_hyperlane = {
                        from = this
                        to = event_target:ex_system
                    }
                }
            }

            random_system = {
                limit = { has_star_flag = legendary_leader_spawn_system }
                spawn_system = {
                    min_distance = 1
                    max_distance = 3
                    max_jumps = 0
                    initializer = "la_legendary_leader_1st_site"
                    hyperlane = no
                    is_discovered = yes
                }
                spawn_system = {
                    min_distance = 1
                    max_distance = 3
                    max_jumps = 0
                    initializer = "la_legendary_leader_2nd_site"
                    hyperlane = no
                    is_discovered = yes
                }
                spawn_system = {
                    min_distance = 1
                    max_distance = 3
                    max_jumps = 0
                    initializer = "la_legendary_leader_3rd_site"
                    hyperlane = no
                    is_discovered = yes
                }
            }
            random_system = {
                limit = { has_star_flag = legendary_leader_1st_system }
                add_hyperlane = {
                    from = this
                    to = event_target:ex_system
                }
            }
            random_system = {
                limit = { has_star_flag = legendary_leader_2nd_system }
                add_hyperlane = {
                    from = this
                    to = event_target:ex_system
                }
            }
            random_system = {
                limit = { has_star_flag = legendary_leader_3rd_system }
                add_hyperlane = {
                    from = this
                    to = event_target:ex_system
                }
            }
            set_spawn_system_batch = end
        }

        country_event = { id = leaderacademy.410 }
    }

    option = {
        name = NAME_The_Beholder
        #paragon.1.name:0 ""
        allow = {
            la_can_afford_legend = yes
            custom_tooltip_fail = {
                text = leaderacademy.beholder.must.not.have.spawned
                NOR = {
                    exists = event_target:beholder_leader
                    exists = event_target:beholder_planet
                    exists = event_target:beholder_presapients
                }
            }

            any_system_within_border = {
                any_system_planet = {
                    OR = {
                        is_planet_class = pc_barren
                        is_planet_class = pc_barren_cold
                        is_planet_class = pc_molten
                        is_planet_class = pc_toxic
                    }
                }
            }
        }

        la_pay_for_legend = yes
        hidden_effect = {
            random_system_within_border = {
                limit = {
                    any_system_planet = {
                        OR = {
                            is_planet_class = pc_barren
                            is_planet_class = pc_barren_cold
                            is_planet_class = pc_molten
                            is_planet_class = pc_toxic
                        }
                    }
                }
                random_system_planet = {
                    limit = {
                        OR = {
                            is_planet_class = pc_barren
                            is_planet_class = pc_barren_cold
                            is_planet_class = pc_molten
                            is_planet_class = pc_toxic
                        }
                    }

                    save_event_target_as = pre_sapient_planet
                }
            }
            country_event = { id = leaderacademy.401 }
        }
    }
}


# Setup event chain as it would be in vanilla
country_event = {
    id = leaderacademy.401
    picture = GFX_evt_ancient_databank
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        set_country_flag = beholder_chain_owner
        event_target:pre_sapient_planet = {
            set_planet_size = 10
            change_pc = pc_continental
            reroll_planet = yes
            save_event_target_as = pre_sapient_planet
            spawn_presapient_species_randomizer_effect = yes
            set_planet_flag = pre_sapient_planet

            weighted_random_owned_pop_group = {
                limit = {
                    is_sapient = no
                }
                species = {
                    save_global_event_target_as = beholder_presapients
                }
            }
            every_owned_pop_group = {
                limit = {
                    is_sapient = no
                }
                add_psionic_trait = yes
            }
            save_global_event_target_as = beholder_planet
            planet_event = { id = leaderacademy.402 }
        }
    }

}

# Setup event chain as it would be in vanilla
planet_event = {
    id = leaderacademy.402
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        planet_event = { id = leaderacademy.403 }
    }
}

planet_event = {
    id = leaderacademy.403
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        random_playable_country = {
            limit = { has_country_flag = beholder_chain_owner }
            country_event = { id = paragon.4  }
        }
    }
}



country_event = {
    id = leaderacademy.410
    title = leaderacademy.410.title
    desc = leaderacademy.410.desc
    picture = GFX_evt_ancient_databank
    is_triggered_only = yes
    location = event_target:ex_system

    option = { name = OK }
}



##############################################


country_event = {
    id = leaderacademy.500
    title = leaderacademy.500.title
    desc = leaderacademy.500.desc
    picture = GFX_evt_ancient_databank
    is_triggered_only = yes

    option = {
        name = leaderacademy.back
        hidden_effect = { country_event = { id = leaderacademy.01 } }
    }
    inline_script = { script = la/enclave_option NAME = NAME_Curator_Order FLAG = curator_enclave_country }
    inline_script = { script = la/enclave_option NAME = NAME_Artisan_Troupe FLAG = artist_enclave_country }
    inline_script = { script = la/enclave_option NAME = NAME_Muutagan_Merchant_Guild FLAG = trader_enclave_country_3 }
    inline_script = { script = la/enclave_option NAME = NAME_Riggan_Commerce_Exchange FLAG = trader_enclave_country_2 }
    inline_script = { script = la/enclave_option NAME = NAME_XuraCorp FLAG = trader_enclave_country_1 }
    inline_script = { script = la/enclave_option NAME = NAME_Asters_Workshop FLAG = salvager_enclave_country }
    inline_script = { script = la/enclave_option NAME = NAME_Shroud_Teachers FLAG = shroudwalker_enclave_country }
    inline_script = { script = la/enclave_option NAME = MINDWARDEN FLAG = mindwarden_enclave_country }
}